<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Prompt Gambar</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');

        :root, [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --primary-color: #2d2d2d;
            --secondary-color: #444;
            --accent-color: #007bff;
            --accent-hover: #0056b3;
            --text-color: #f0f0f0;
            --label-color: #bbb;
            --border-color: #555;
            --tag-bg: #555;
            --tag-hover: #777;
            --tag-selected-bg: var(--accent-color);
            --tag-selected-hover: var(--accent-hover);
            --modal-bg: rgba(0, 0, 0, 0.7);
        }

        [data-theme="light"] {
            --bg-color: #f0f0f0;
            --primary-color: #ffffff;
            --secondary-color: #e9e9e9;
            --accent-color: #007bff;
            --accent-hover: #0056b3;
            --text-color: #1a1a1a;
            --label-color: #555;
            --border-color: #ccc;
            --tag-bg: #e0e0e0;
            --tag-hover: #c9c9c9;
            --modal-bg: rgba(0, 0, 0, 0.4);
        }

        [data-theme="blue"] {
            --bg-color: #0f172a;
            --primary-color: #1e293b;
            --secondary-color: #334155;
            --accent-color: #38bdf8;
            --accent-hover: #0ea5e9;
            --text-color: #f1f5f9;
            --label-color: #94a3b8;
            --border-color: #475569;
            --tag-bg: #475569;
            --tag-hover: #64748b;
            --modal-bg: rgba(15, 23, 42, 0.7);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: var(--primary-color);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .prompt-builder {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--label-color);
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.75rem;
            color: var(--text-color);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .input-group select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23bbb%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.4-5.4-12.8z%22/%3E%3C/svg%3E');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 0.65em auto;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-color) 25%, transparent);
        }
        
        .section-title {
            grid-column: 1 / -1;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-top: 1rem;
            margin-bottom: -0.5rem;
            font-size: 1.2rem;
            color: var(--accent-color);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        button, .button {
            flex-grow: 1;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            text-align: center;
            text-decoration: none;
            color: var(--text-color);
        }

        #generate-btn {
            background-color: var(--accent-color);
            color: white;
        }

        #generate-btn:hover {
            background-color: var(--accent-hover);
        }
        
        #copy-btn, #manage-characters-btn {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        #copy-btn:hover, #manage-characters-btn:hover {
            background-color: color-mix(in srgb, var(--secondary-color) 85%, #000);
        }
        
        button:active, .button:active {
            transform: scale(0.98);
        }

        #result-container {
            margin-top: 2rem;
        }

        #result-prompt {
            height: 250px;
            resize: vertical;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
        }
        
        .copy-feedback {
            text-align: center;
            margin-top: 0.5rem;
            color: var(--accent-color);
            opacity: 0;
            transition: opacity 0.5s;
        }

        .style-tags-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .style-category {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .style-category-title {
            font-weight: 600;
            color: var(--accent-color);
            margin-bottom: 0.75rem;
            display: block;
        }

        .style-tags-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .style-tag {
            background-color: var(--tag-bg);
            color: var(--text-color);
            padding: 0.5rem 0.8rem;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 0.9rem;
        }

        .style-tag:hover {
            background-color: var(--tag-hover);
        }

        .style-tag.selected {
            background-color: var(--tag-selected-bg);
            color: white;
        }

        .style-tag.selected:hover {
            background-color: var(--tag-selected-hover);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: var(--modal-bg);
        }

        .modal-content {
            background-color: var(--primary-color);
            margin: 5% auto;
            padding: 2rem;
            border: 1px solid var(--border-color);
            width: 80%;
            max-width: 700px;
            border-radius: 12px;
            position: relative;
        }

        .close-btn {
            color: var(--label-color);
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--text-color);
        }

        #character-list {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }

        #character-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        #character-list li:last-child {
            border-bottom: none;
        }

        .char-actions button {
            margin-left: 0.5rem;
            padding: 0.3rem 0.7rem;
            font-size: 0.9rem;
            flex-grow: 0;
        }

        .character-details-form-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .character-details-form-group.full-width {
            grid-template-columns: 1fr;
        }
        .character-details-form-group .input-group {
            margin-bottom: 0;
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>Generator Prompt Gambar (Output JSON)</h1>
        
        <div class="input-group" style="margin-bottom: 1.5rem;">
            <label for="theme-select">Pilih Tema</label>
            <select id="theme-select">
                <option value="dark">Gelap</option>
                <option value="light">Terang</option>
                <option value="blue">Biru</option>
            </select>
        </div>

        <div id="prompt-form" class="prompt-builder">
            
            <h2 class="section-title">Visual</h2>

            <div class="input-group">
                <label for="character-select">Pilih Karakter</label>
                <div style="display: flex; gap: 1rem;">
                    <select id="character-select" style="flex-grow: 1;">
                        <option value="">-- Tanpa Karakter --</option>
                    </select>
                    <button id="manage-characters-btn" class="button">Kelola</button>
                </div>
            </div>

            <div class="input-group">
                <label for="action">Aksi / Pose</label>
                <input type="text" id="action" placeholder="Contoh: Berdiri tegap memegang katana">
            </div>

            <div class="input-group">
                <label for="setting">Latar (Lokasi & Lingkungan)</label>
                <input type="text" id="setting" placeholder="Contoh: Hutan bambu yang disinari cahaya bulan">
            </div>

            <div class="input-group">
                <label for="style-input">Gaya Visual</label>
                <div id="style-tags-container" class="style-tags-container">
                    <!-- Style tags will be loaded here by JavaScript -->
                </div>
                <input type="text" id="style-custom" placeholder="Atau masukkan gaya kustom lainnya, pisahkan dengan koma" style="margin-top: 0.5rem;">
                
                <label for="photographer-select" style="margin-top: 1rem;">Referensi Gaya Fotografer</label>
                <select id="photographer-select">
                    <option value="">-- Tidak ada --</option>
                    <option value="Ansel Adams">Ansel Adams - Lanskap Hitam Putih Kontras Tinggi</option>
                    <option value="Annie Leibovitz">Annie Leibovitz - Potret Konseptual & Dramatis</option>
                    <option value="Steve McCurry">Steve McCurry - Perjalanan & Jurnalistik Penuh Warna</option>
                    <option value="Henri Cartier-Bresson">Henri Cartier-Bresson - Street Photography & Momen Penentu (B&W)</option>
                    <option value="Sebastião Salgado">Sebastião Salgado - Dokumenter Sosial Skala Besar (B&W)</option>
                    <option value="Yousuf Karsh">Yousuf Karsh - Potret Studio Ikonik & Pencahayaan Dramatis</option>
                    <option value="Robert Capa">Robert Capa - Fotografi Perang (Getaran 'In-the-Action')</option>
                    <option value="Dorothea Lange">Dorothea Lange - Dokumenter Era Depresi & Kemanusiaan</option>
                    <option value="Irving Penn">Irving Penn - Fashion & Potret Elegan Minimalis</option>
                    <option value="Richard Avedon">Richard Avedon - Potret Minimalis & Fashion (Latar Belakang Putih)</option>
                    <option value="Gregory Crewdson">Gregory Crewdson - Pemandangan Sinematik & Sureal</option>
                    <option value="Cindy Sherman">Cindy Sherman - Potret Diri Konseptual & Kritik Sosial</option>
                    <option value="Tim Walker">Tim Walker - Fashion Sureal & Fantastis</option>
                </select>

                <label for="japanese-style-select" style="margin-top: 1rem;">Referensi Gaya Jepang</label>
                <select id="japanese-style-select">
                    <option value="">-- Tidak ada --</option>
                    <option value="Hayao Miyazaki (Studio Ghibli)">Hayao Miyazaki (Studio Ghibli) - Animasi Fantasi & Penuh Pesona</option>
                    <option value="Akira Kurosawa">Akira Kurosawa - Komposisi Sinematik Epik (Gaya Samurai)</option>
                    <option value="Takashi Murakami">Takashi Murakami - Superflat (Pop Art & Anime)</option>
                    <option value="Yayoi Kusama">Yayoi Kusama - Seni Pop & Pola Berulang (Polka Dots)</option>
                    <option value="Daido Moriyama">Daido Moriyama - Street Photography (Kontras Tinggi, Grainy, B&W)</option>
                    <option value="Nobuyoshi Araki">Nobuyoshi Araki - Fotografi Erotis & Personal (Gaya Buku Harian)</option>
                    <option value="Rinko Kawauchi">Rinko Kawauchi - Puitis & Tenang (Palet Warna Lembut)</option>
                    <option value="Hiroshi Sugimoto">Hiroshi Sugimoto - Konseptual & Minimalis (Long Exposure)</option>
                </select>

                <label for="color-tone-select" style="margin-top: 1rem;">Color Tone</label>
                <select id="color-tone-select">
                    <option value="">-- Tidak ada --</option>
                    <option value="Fuji Color Tone">Fuji Color Tone - Hijau & Biru Cerah, Nada Kulit Menyenangkan</option>
                    <option value="Kodak Portra Color Tone">Kodak Portra Color Tone - Hangat, Alami, Warna Lembut</option>
                    <option value="Cinematic Color Grading">Cinematic Color Grading - Sering Teal & Oranye, Desaturasi</option>
                    <option value="Vintage/Retro Color Tone">Vintage/Retro Color Tone - Sepia, Pudar, Hangat, Desaturasi</option>
                    <option value="Monochromatic/Black & White">Monochromatic/Black & White - Hitam Putih</option>
                    <option value="Vibrant/Pop Color Tone">Vibrant/Pop Color Tone - Jenuh, Cerah, Mencolok</option>
                    <option value="Muted/Earthy Color Tone">Muted/Earthy Color Tone - Desaturasi, Alami, Redup</option>
                    <option value="Cool/Blue Tones">Cool/Blue Tones - Menekankan Biru & Hijau Dingin</option>
                    <option value="Warm/Golden Tones">Warm/Golden Tones - Menekankan Kuning, Oranye, & Merah</option>
                </select>

                <label for="angle-select" style="margin-top: 1rem;">Angle Foto</label>
                <select id="angle-select">
                    <option value="">-- Tidak ada --</option>
                    <option value="Low Angle">Low Angle (Sudut Rendah)</option>
                    <option value="High Angle">High Angle (Sudut Tinggi)</option>
                    <option value="Eye-level Shot">Eye-level Shot (Setinggi Mata)</option>
                    <option value="Dutch Angle">Dutch Angle (Miring)</option>
                    <option value="Worm's Eye View">Worm's Eye View (Sudut Pandang Cacing)</option>
                    <option value="Bird's Eye View">Bird's Eye View (Sudut Pandang Burung)</option>
                    <option value="Over-the-shoulder Shot">Over-the-shoulder Shot (Dari Balik Bahu)</option>
                </select>

                <label for="camera-type-select" style="margin-top: 1rem;">Jenis Kamera</label>
                <select id="camera-type-select">
                    <option value="">-- Tidak ada --</option>
                    <option value="Smartphone Camera">Smartphone Camera</option>
                    <option value="iPhone Camera">iPhone Camera</option>
                    <option value="DSLR Camera">DSLR Camera</option>
                    <option value="Mirrorless Camera">Mirrorless Camera</option>
                    <option value="Medium Format Camera">Medium Format Camera</option>
                    <option value="Large Format Camera">Large Format Camera</option>
                    <option value="Drone Camera">Drone Camera</option>
                    <option value="GoPro Camera">GoPro Camera</option>
                    <option value="Vintage Camera">Vintage Camera</option>
                    <option value="Disposable Camera">Disposable Camera</option>
                </select>
            </div>
        </div>

        <div class="button-group">
            <button id="generate-btn">Hasilkan Prompt JSON</button>
        </div>

        <div id="result-container">
            <div class="input-group">
                <label for="result-prompt">JSON yang Dihasilkan</label>
                <textarea id="result-prompt" readonly></textarea>
                <div class="copy-feedback" id="copy-feedback">Berhasil disalin!</div>
            </div>
            <div class="button-group">
                 <button id="copy-btn">Salin JSON</button>
            </div>
        </div>
    </div>

    <!-- Character Management Modal -->
    <div id="character-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Kelola Karakter</h2>
            <form id="character-form">
                <input type="hidden" id="character-id">
                <div class="input-group">
                    <label for="char-name">Nama Karakter</label>
                    <input type="text" id="char-name" required placeholder="Contoh: 'Detektif K'">
                </div>

                <h3 class="section-title">Detail Fisik</h3>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-gender">Gender</label>
                        <input type="text" id="char-gender" placeholder="Pria/Wanita">
                    </div>
                    <div class="input-group">
                        <label for="char-age">Usia</label>
                        <input type="text" id="char-age" placeholder="Dewasa Muda, Sekitar 30 tahun">
                    </div>
                </div>
                <div class="character-details-form-group full-width">
                    <div class="input-group">
                        <label for="char-ethnicity">Etnisitas</label>
                        <input type="text" id="char-ethnicity" placeholder="Asia Tenggara, Kaukasia, Jepang">
                    </div>
                </div>

                <h4 class="section-title">Wajah</h4>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-face-shape">Bentuk Wajah</label>
                        <select id="char-face-shape">
                            <option value="">-- Pilih --</option>
                            <option value="Oval">Oval</option>
                            <option value="Bulat">Bulat</option>
                            <option value="Persegi">Persegi</option>
                            <option value="Hati">Hati</option>
                            <option value="Panjang">Panjang</option>
                            <option value="Berlian">Berlian</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="char-skin-tone">Warna Kulit</label>
                        <select id="char-skin-tone">
                            <option value="">-- Pilih --</option>
                            <option value="Pucat">Pucat</option>
                            <option value="Cerah">Cerah</option>
                            <option value="Sawo Matang">Sawo Matang</option>
                            <option value="Gelap">Gelap</option>
                            <option value="Zaitun">Zaitun</option>
                        </select>
                    </div>
                </div>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-eye-color">Warna Mata</label>
                        <select id="char-eye-color">
                            <option value="">-- Pilih --</option>
                            <option value="Coklat">Coklat</option>
                            <option value="Biru">Biru</option>
                            <option value="Hijau">Hijau</option>
                            <option value="Abu-abu">Abu-abu</option>
                            <option value="Hazel">Hazel</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="char-nose-shape">Bentuk Hidung</label>
                        <select id="char-nose-shape">
                            <option value="">-- Pilih --</option>
                            <option value="Mancung">Mancung</option>
                            <option value="Pesek">Pesek</option>
                            <option value="Kecil">Kecil</option>
                            <option value="Besar">Besar</option>
                            <option value="Standar">Standar</option>
                        </select>
                    </div>
                </div>
                <div class="character-details-form-group full-width">
                    <div class="input-group">
                        <label for="char-lip-shape">Bentuk Bibir</label>
                        <select id="char-lip-shape">
                            <option value="">-- Pilih --</option>
                            <option value="Penuh">Penuh</option>
                            <option value="Tipis">Tipis</option>
                            <option value="Standar">Standar</option>
                            <option value="Hati">Hati</option>
                            <option value="Busur Cupid">Busur Cupid</option>
                        </select>
                    </div>
                </div>

                <h4 class="section-title">Rambut</h4>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-hair-color">Warna Rambut</label>
                        <select id="char-hair-color">
                            <option value="">-- Pilih --</option>
                            <option value="Hitam">Hitam</option>
                            <option value="Pirang">Pirang</option>
                            <option value="Coklat">Coklat</option>
                            <option value="Merah">Merah</option>
                            <option value="Abu-abu">Abu-abu</option>
                            <option value="Putih">Putih</option>
                            <option value="Biru">Biru</option>
                            <option value="Hijau">Hijau</option>
                            <option value="Ungu">Ungu</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="char-hair-style">Gaya Rambut</label>
                        <select id="char-hair-style">
                            <option value="">-- Pilih --</option>
                            <option value="Lurus">Lurus</option>
                            <option value="Bergelombang">Bergelombang</option>
                            <option value="Keriting">Keriting</option>
                            <option value="Ikal">Ikal</option>
                            <option value="Kuncir Kuda">Kuncir Kuda</option>
                            <option value="Kepang">Kepang</option>
                            <option value="Cepol">Cepol</option>
                            <option value="Undercut">Undercut</option>
                            <option value="Bob">Bob</option>
                            <option value="Pixie">Pixie</option>
                            <option value="Gondrong">Gondrong</option>
                            <option value="Mohawk">Mohawk</option>
                            <option value="Dreadlock">Dreadlock</option>
                            <option value="Afro">Afro</option>
                        </select>
                    </div>
                </div>
                <div class="character-details-form-group full-width">
                    <div class="input-group">
                        <label for="char-hair-length">Panjang Rambut</label>
                        <select id="char-hair-length">
                            <option value="">-- Pilih --</option>
                            <option value="Botak">Botak</option>
                            <option value="Sangat Pendek">Sangat Pendek</option>
                            <option value="Pendek">Pendek</option>
                            <option value="Sebahu">Sebahu</option>
                            <option value="Panjang">Panjang</option>
                            <option value="Sangat Panjang">Sangat Panjang</option>
                        </select>
                    </div>
                </div>

                <h4 class="section-title">Tubuh</h4>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-body-build">Bentuk Tubuh</label>
                        <select id="char-body-build">
                            <option value="">-- Pilih --</option>
                            <option value="Rata-rata">Rata-rata</option>
                            <option value="Langsing">Langsing</option>
                            <option value="Ramping">Ramping</option>
                            <option value="Atletis">Atletis</option>
                            <option value="Berotot">Berotot</option>
                            <option value="Berisi">Berisi</option>
                            <option value="Bentuk tubuh sintal">Bentuk tubuh sintal</option>
                            <option value="Proporsional">Proporsional</option>
                            <option value="Ideal">Ideal</option>
                            <option value="Berlekuk">Berlekuk</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="char-body-height">Tinggi Badan</label>
                        <input type="text" id="char-body-height" placeholder="170cm, Tinggi, Pendek">
                    </div>
                </div>

                <h4 class="section-title">Pakaian</h4>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-clothing-style">Gaya Pakaian</label>
                        <select id="char-clothing-style">
                            <option value="">-- Pilih --</option>
                            <option value="Kasual">Kasual</option>
                            <option value="Formal">Formal</option>
                            <option value="Sporty">Sporty</option>
                            <option value="Bohemian">Bohemian</option>
                            <option value="Minimalis">Minimalis</option>
                            <option value="Vintage">Vintage</option>
                            <option value="Streetwear">Streetwear</option>
                            <option value="Gothic">Gothic</option>
                            <option value="Punk">Punk</option>
                            <option value="Klasik">Klasik</option>
                            <option value="Modern">Modern</option>
                            <option value="Futuristik">Futuristik</option>
                            <option value="Etnik">Etnik</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="char-clothing-top">Atasan</label>
                        <select id="char-clothing-top">
                            <option value="">-- Pilih --</option>
                            <option value="Kaos">Kaos</option>
                            <option value="Kemeja">Kemeja</option>
                            <option value="Blus">Blus</option>
                            <option value="Sweater">Sweater</option>
                            <option value="Hoodie">Hoodie</option>
                            <option value="Jaket">Jaket</option>
                            <option value="Blazer">Blazer</option>
                            <option value="Rompi">Rompi</option>
                            <option value="Tank Top">Tank Top</option>
                            <option value="Crop Top">Crop Top</option>
                        </select>
                    </div>
                </div>
                <div class="character-details-form-group">
                    <div class="input-group">
                        <label for="char-clothing-bottom">Bawahan</label>
                        <select id="char-clothing-bottom">
                            <option value="">-- Pilih --</option>
                            <option value="Celana Jeans">Celana Jeans</option>
                            <option value="Celana Kain">Celana Kain</option>
                            <option value="Rok Mini">Rok Mini</option>
                            <option value="Rok Midi">Rok Midi</option>
                            <option value="Rok Maxi">Rok Maxi</option>
                            <option value="Celana Pendek">Celana Pendek</option>
                            <option value="Legging">Legging</option>
                            <option value="Jogger">Jogger</option>
                            <option value="Kulot">Kulot</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="char-clothing-footwear">Alas Kaki</label>
                        <select id="char-clothing-footwear">
                            <option value="">-- Pilih --</option>
                            <option value="Sepatu Kets">Sepatu Kets</option>
                            <option value="Sepatu Pantofel">Sepatu Pantofel</option>
                            <option value="Sepatu Hak Tinggi">Sepatu Hak Tinggi</option>
                            <option value="Sandal">Sandal</option>
                            <option value="Boots">Boots</option>
                            <option value="Flat Shoes">Flat Shoes</option>
                            <option value="Loafers">Loafers</option>
                        </select>
                    </div>
                </div>

                <h4 class="section-title">Ciri Khas</h4>
                <div class="character-details-form-group full-width">
                    <div class="input-group">
                        <label for="char-feature-1">Ciri Khas 1</label>
                        <input type="text" id="char-feature-1" placeholder="Bekas luka di pipi, Tato naga di lengan">
                    </div>
                </div>
                <div class="character-details-form-group full-width">
                    <div class="input-group">
                        <label for="char-feature-2">Ciri Khas 2</label>
                        <input type="text" id="char-feature-2" placeholder="Kacamata bulat, Anting besar">
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="button" id="save-character-btn">Simpan Karakter</button>
                </div>
            </form>
            <hr style="margin: 2rem 0; border-color: var(--border-color);">
            <h3>Karakter Tersimpan</h3>
            <ul id="character-list">
                <!-- Character list will be populated by JavaScript -->
            </ul>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- THEME ---
            const themeSelect = document.getElementById('theme-select');
            const setTheme = (theme) => {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('image-gen-theme', theme);
            };
            themeSelect.addEventListener('change', () => setTheme(themeSelect.value));
            const savedTheme = localStorage.getItem('image-gen-theme') || 'dark';
            themeSelect.value = savedTheme;
            setTheme(savedTheme);

            // --- DOM ELEMENTS ---
            const generateBtn = document.getElementById('generate-btn');
            const copyBtn = document.getElementById('copy-btn');
            const resultPrompt = document.getElementById('result-prompt');
            const copyFeedback = document.getElementById('copy-feedback');
            const styleTagsContainer = document.getElementById('style-tags-container');
            const photographerSelect = document.getElementById('photographer-select');
            const japaneseStyleSelect = document.getElementById('japanese-style-select');
            const colorToneSelect = document.getElementById('color-tone-select');
            
            // --- CHARACTER MODAL ELEMENTS ---
            const characterModal = document.getElementById('character-modal');
            const manageCharactersBtn = document.getElementById('manage-characters-btn');
            const closeModalBtn = characterModal.querySelector('.close-btn');
            const characterForm = document.getElementById('character-form');
            const characterIdInput = document.getElementById('character-id');
            const characterNameInput = document.getElementById('char-name');

            // Individual character detail inputs
            const charGenderInput = document.getElementById('char-gender');
            const charAgeInput = document.getElementById('char-age');
            const charEthnicityInput = document.getElementById('char-ethnicity');
            const charFaceShapeInput = document.getElementById('char-face-shape');
            const charSkinToneInput = document.getElementById('char-skin-tone');
            const charEyeColorInput = document.getElementById('char-eye-color');
            const charNoseShapeInput = document.getElementById('char-nose-shape');
            const charLipShapeInput = document.getElementById('char-lip-shape');
            const charHairColorInput = document.getElementById('char-hair-color');
            const charHairStyleInput = document.getElementById('char-hair-style');
            const charHairLengthInput = document.getElementById('char-hair-length');
            const charBodyBuildInput = document.getElementById('char-body-build');
            const charBodyHeightInput = document.getElementById('char-body-height');
            const charClothingStyleInput = document.getElementById('char-clothing-style');
            const charClothingTopInput = document.getElementById('char-clothing-top');
            const charClothingBottomInput = document.getElementById('char-clothing-bottom');
            const charClothingFootwearInput = document.getElementById('char-clothing-footwear');
            const charFeature1Input = document.getElementById('char-feature-1');
            const charFeature2Input = document.getElementById('char-feature-2');

            const characterListUl = document.getElementById('character-list');
            const characterSelect = document.getElementById('character-select');

            // --- DATA ---
            const selectedStyles = new Set();
            let characters = JSON.parse(localStorage.getItem('image-gen-characters')) || [];
            
            const getInitialCharacterTemplate = () => ({
                gender: "",
                age: "",
                ethnicity: "",
                face: {
                    shape: "",
                    skin_tone: "",
                    eye_color: "",
                    nose_shape: "",
                    lip_shape: ""
                },
                hair: {
                    color: "",
                    style: "",
                    length: ""
                },
                body: {
                    build: "",
                    height: ""
                },
                clothing: {
                    style: "",
                    top: "",
                    bottom: "",
                    footwear: ""
                },
                distinguishing_features: {
                    feature_1: "",
                    feature_2: ""
                }
            });

            const ids = {
                action: 'action',
                setting: 'setting',
                styleCustom: 'style-custom',
            };

            const styles = [
                { category: 'Realistis & Fotografi', tags: [
                    'Hyperrealistic', 'Photorealistic', 'Analog Style', 'Film Grain', 'Macro Photography', 'Long Exposure', 'Golden Hour Lighting', 'Studio Lighting', '8K', '4K', 'HD', 'DSLR', 'High-Contrast', 'Vibrant Color Palette', 'Muted Color Palette', 'Black and White',
                    'Fotografi Potret', 'Potret Studio', 'Potret Lingkungan (Environmental Portrait)', 'Potret Candid', 'Potret Gaya Hidup (Lifestyle Portrait)', 'Potret Headshot', 'Potret Keluarga/Grup',
                    'Fotografi Fashion', 'Editorial Fashion', 'Katalog Fashion', 'Haute Couture Photography', 'Street Style Photography',
                    'Fotografi Jurnalistik/Dokumenter (berfokus pada manusia)', 'Fotografi Street', 'Fotografi Pernikahan', 'Dokumenter Pernikahan', 'Potret Pernikahan', 'Gaya Hidup Pernikahan',
                    'Fotografi Olahraga', 'Fotografi Konser/Pertunjukan', 'Fotografi Bayi Baru Lahir (Newborn Photography)'
                ]},
                { category: 'Genre & Tema', tags: ['Film Noir', 'Vintage Photo (1950s)', 'Cyberpunk', 'Steampunk', 'Fantasy', 'Sci-Fi', 'Gothic', 'Minimalist']}
            ];

            // --- CHARACTER MANAGEMENT ---
            const openModal = () => characterModal.style.display = 'block';
            const closeModal = () => {
                characterModal.style.display = 'none';
                characterForm.reset();
                characterIdInput.value = '';
            };

            const saveCharacters = () => {
                localStorage.setItem('image-gen-characters', JSON.stringify(characters));
            };

            const renderCharacters = () => {
                characterListUl.innerHTML = '';
                characterSelect.innerHTML = '<option value="">-- Tanpa Karakter --</option>';
                
                characters.forEach(char => {
                    const option = document.createElement('option');
                    option.value = char.id;
                    option.textContent = char.name;
                    characterSelect.appendChild(option);

                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${char.name}</span>
                        <div class="char-actions">
                            <button class="button edit-btn" data-id="${char.id}">Edit</button>
                            <button class="button delete-btn" data-id="${char.id}">Hapus</button>
                        </div>
                    `;
                    characterListUl.appendChild(li);
                });
            };

            const populateCharacterForm = (charData) => {
                characterIdInput.value = charData.id || '';
                characterNameInput.value = charData.name || '';
                const details = JSON.parse(charData.details || JSON.stringify(getInitialCharacterTemplate()));

                charGenderInput.value = details.gender || '';
                charAgeInput.value = details.age || '';
                charEthnicityInput.value = details.ethnicity || '';
                charFaceShapeInput.value = details.face.shape || '';
                charSkinToneInput.value = details.face.skin_tone || '';
                charEyeColorInput.value = details.face.eye_color || '';
                charNoseShapeInput.value = details.face.nose_shape || '';
                charLipShapeInput.value = details.face.lip_shape || '';
                charHairColorInput.value = details.hair.color || '';
                charHairStyleInput.value = details.hair.style || '';
                charHairLengthInput.value = details.hair.length || '';
                charBodyBuildInput.value = details.body.build || '';
                charBodyHeightInput.value = details.body.height || '';
                charClothingStyleInput.value = details.clothing.style || '';
                charClothingTopInput.value = details.clothing.top || '';
                charClothingBottomInput.value = details.clothing.bottom || '';
                charClothingFootwearInput.value = details.clothing.footwear || '';
                charFeature1Input.value = details.distinguishing_features.feature_1 || '';
                charFeature2Input.value = details.distinguishing_features.feature_2 || '';
            };

            manageCharactersBtn.addEventListener('click', () => {
                characterForm.reset();
                populateCharacterForm({ details: JSON.stringify(getInitialCharacterTemplate()) }); // Load initial template
                openModal();
            });

            closeModalBtn.addEventListener('click', closeModal);
            window.addEventListener('click', (e) => {
                if (e.target == characterModal) closeModal();
            });

            characterForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = characterIdInput.value;
                const name = characterNameInput.value.trim();

                if (!name) {
                    alert('Nama Karakter tidak boleh kosong.');
                    return;
                }

                const details = {
                    gender: charGenderInput.value.trim(),
                    age: charAgeInput.value.trim(),
                    ethnicity: charEthnicityInput.value.trim(),
                    face: {
                        shape: charFaceShapeInput.value.trim(),
                        skin_tone: charSkinToneInput.value.trim(),
                        eye_color: charEyeColorInput.value.trim(),
                        nose_shape: charNoseShapeInput.value.trim(),
                        lip_shape: charLipShapeInput.value.trim()
                    },
                    hair: {
                        color: charHairColorInput.value.trim(),
                        style: charHairStyleInput.value.trim(),
                        length: charHairLengthInput.value.trim()
                    },
                    body: {
                        build: charBodyBuildInput.value.trim(),
                        height: charBodyHeightInput.value.trim()
                    },
                    clothing: {
                        style: charClothingStyleInput.value.trim(),
                        top: charClothingTopInput.value.trim(),
                        bottom: charClothingBottomInput.value.trim(),
                        footwear: charClothingFootwearInput.value.trim()
                    },
                    distinguishing_features: {
                        feature_1: charFeature1Input.value.trim(),
                        feature_2: charFeature2Input.value.trim()
                    }
                };

                // Clean up empty nested objects/properties before saving
                for (const key in details) {
                    if (typeof details[key] === 'object' && !Array.isArray(details[key])) {
                        let allEmpty = true;
                        for (const subKey in details[key]) {
                            if (details[key][subKey]) {
                                allEmpty = false;
                                break;
                            }
                        }
                        if (allEmpty) delete details[key];
                    } else if (!details[key]) {
                        delete details[key];
                    }
                }

                const detailsJsonString = JSON.stringify(details, null, 2);

                if (id) { // Editing existing
                    const charIndex = characters.findIndex(c => c.id == id);
                    if (charIndex > -1) {
                        characters[charIndex].name = name;
                        characters[charIndex].details = detailsJsonString;
                    }
                } else { // Creating new
                    characters.push({
                        id: Date.now().toString(),
                        name: name,
                        details: detailsJsonString
                    });
                }
                
                saveCharacters();
                renderCharacters();
                closeModal();
            });

            characterListUl.addEventListener('click', (e) => {
                const id = e.target.dataset.id;
                if (!id) return;

                if (e.target.classList.contains('edit-btn')) {
                    const char = characters.find(c => c.id === id);
                    if (char) {
                        populateCharacterForm(char);
                        openModal();
                    }
                }

                if (e.target.classList.contains('delete-btn')) {
                    if (confirm(`Apakah Anda yakin ingin menghapus karakter "${characters.find(c=>c.id===id).name}"?`)) {
                        characters = characters.filter(c => c.id !== id);
                        saveCharacters();
                        renderCharacters();
                    }
                }
            });


            // --- RENDER INITIAL UI ---
            styles.forEach(cat => {
                const categoryContainer = document.createElement('div');
                categoryContainer.classList.add('style-category');
                const categoryTitle = document.createElement('span');
                categoryTitle.classList.add('style-category-title');
                categoryTitle.textContent = cat.category;
                categoryContainer.appendChild(categoryTitle);
                const tagsWrapper = document.createElement('div');
                tagsWrapper.classList.add('style-tags-wrapper');
                cat.tags.forEach(tagText => {
                    const tag = document.createElement('span');
                    tag.classList.add('style-tag');
                    tag.textContent = tagText;
                    tag.dataset.value = tagText;
                    tag.addEventListener('click', () => {
                        if (selectedStyles.has(tagText)) {
                            selectedStyles.delete(tagText);
                            tag.classList.remove('selected');
                        } else {
                            selectedStyles.add(tagText);
                            tag.classList.add('selected');
                        }
                    });
                    tagsWrapper.appendChild(tag);
                });
                categoryContainer.appendChild(tagsWrapper);
                styleTagsContainer.appendChild(categoryContainer);
            });

            // --- GENERATE PROMPT ---
            generateBtn.addEventListener('click', () => {
                const getVal = id => document.getElementById(id).value.trim();

                let selectedStyleArray = Array.from(selectedStyles);
                const customStyle = getVal(ids.styleCustom);
                if (customStyle) {
                    selectedStyleArray = selectedStyleArray.concat(customStyle.split(',').map(s => s.trim()).filter(Boolean));
                }
                
                const photographerStyle = photographerSelect.value;
                if (photographerStyle) {
                    selectedStyleArray.push(`in the style of ${photographerStyle}`);
                }

                const japaneseStyle = japaneseStyleSelect.value;
                if (japaneseStyle) {
                    selectedStyleArray.push(`in the style of ${japaneseStyle}`);
                }

                const colorToneStyle = colorToneSelect.value;
                if (colorToneStyle) {
                    selectedStyleArray.push(`${colorToneStyle}`);
                }

                const angleStyle = getVal('angle-select');
                if (angleStyle) {
                    selectedStyleArray.push(`${angleStyle} Shot`);
                }

                const cameraTypeStyle = getVal('camera-type-select');
                if (cameraTypeStyle) {
                    selectedStyleArray.push(`Shot with ${cameraTypeStyle}`);
                }

                const promptObject = {
                    visual: {}
                };

                // --- SUBJECT & CHARACTER INTEGRATION ---
                const selectedCharId = characterSelect.value;
                if (selectedCharId) {
                    const char = characters.find(c => c.id === selectedCharId);
                    if (char) {
                        try {
                            const charDetails = JSON.parse(char.details);
                            const fullSubject = {
                                "nama_karakter": char.name,
                                "karakter_konsisten": charDetails
                            };
                            promptObject.visual.subject = fullSubject;
                        } catch (e) {
                            console.error("Error parsing character JSON:", e);
                            // Fallback: if JSON is invalid, just use character name as subject
                            promptObject.visual.subject = char.name;
                        }
                    }
                } else {
                    // If no character selected, visual.subject will be omitted
                }


                const visual = promptObject.visual;
                if (getVal(ids.action)) visual.action = getVal(ids.action);
                if (getVal(ids.setting)) visual.setting = getVal(ids.setting);
                if (selectedStyleArray.length > 0) promptObject.style = selectedStyleArray.join(', ');

                // Clean up empty objects
                if (Object.keys(promptObject.visual).length === 0) delete promptObject.visual;
                if (!promptObject.style) delete promptObject.style;

                resultPrompt.value = JSON.stringify(promptObject, null, 2);
            });

            // --- COPY BUTTON ---
            copyBtn.addEventListener('click', () => {
                if (resultPrompt.value) {
                    navigator.clipboard.writeText(resultPrompt.value).then(() => {
                        copyFeedback.style.opacity = '1';
                        setTimeout(() => {
                            copyFeedback.style.opacity = '0';
                        }, 2000);
                    });
                }
            });

            // --- INITIAL LOAD ---
            renderCharacters();
        });
    </script>

</body>
</html>